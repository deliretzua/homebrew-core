class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-08-31",
      revision: "32e384bbf01ba2a220468f0849410465b4fc818d"
  version "2021-08-31"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "b4aca8ff9f24dd694ba62b5c75ff08bfa78c288bf0534acc864e85bd9343988d"
    sha256 cellar: :any_skip_relocation, big_sur:       "ad96296c2c40b0fbc4378e898d8d8f8687cb6b2480c36ef9e01aec01acf43344"
    sha256 cellar: :any_skip_relocation, catalina:      "83da3576076c2943186d36d06c9e515b24f902112f973da0aa027b1056a32c16"
    sha256 cellar: :any_skip_relocation, mojave:        "2959b3b7a3d1a9906efb6e41dec51d3e9e6c429398abc4588cae401f5fd60dc4"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "885b7e346028d1d393a73858045b88390a99e51de2f2c4cdaa38b4eae0800b4d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
