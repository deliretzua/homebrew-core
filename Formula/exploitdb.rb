class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-30",
      revision: "de260aeac64464483585e80a5593c014d222d719"
  version "2021-10-30"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "065195be595a114e63a0a24f758c025ffa66d172d75a88815d37172cfe384d81"
    sha256 cellar: :any_skip_relocation, big_sur:       "2c16e887ea658179cb13c4bb75fe6bd195039047bfb844d7429b6cb8ea4badf7"
    sha256 cellar: :any_skip_relocation, catalina:      "f27746c7e3871386cc04e5bea7a7521ceecfb9917a5c6d87e3ed9426879b683e"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "d52f27e88b28acf1993213a968ad89c837fd827b33bf280b55ab00685accc713"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
