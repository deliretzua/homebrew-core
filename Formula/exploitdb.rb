class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-03-09",
      revision: "188f217da1809ebbb5c31d2e165ea7da21a0b9a9"
  version "2022-03-09"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6a732e8b7867584e6637a2d2ad1ed7d143bece0d18a714ec81e15928cd756469"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "5b7224d97487165ae1d1ab8177b4766cb024acd73436c24c62c2887815d4848e"
    sha256 cellar: :any_skip_relocation, monterey:       "689515c978a9fe9efab1e0e76bd2357e0316b8b099ec0fcc671ffa607626d805"
    sha256 cellar: :any_skip_relocation, big_sur:        "964572120d3a61c6bd9fb12edef0eed1ec262c0de17106e099d05fdd3e7d4242"
    sha256 cellar: :any_skip_relocation, catalina:       "da497eca703955d2ae4157f8abe8ef9c9c6d2fe9aeac223109185488f5445b43"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b4dce9bc9e682456a008b55729bf97353ef9a98398a6cd0f9865320aeb44639d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
