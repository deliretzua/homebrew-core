class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-06-16",
      revision: "1e4f82620abfd39ccbe7962dc1f2ff1b286469a4"
  version "2023-06-16"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "15bcd6ca211f632905732b84c85567c414d505a6ff44844b0853841fdb1b673c"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "5a572d461dbc63b3b635b8a50d41c7b7add78938fb0701f62fa056a0a22d5d3e"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "519d72c1876b298fb2fedf0e240fc7d669e244e2535206a4ea7ba13c30ae80d8"
    sha256 cellar: :any_skip_relocation, ventura:        "c44f001c6b0ad8767d931f56095ea44328d01c22a178c6187d9bf52db7795e02"
    sha256 cellar: :any_skip_relocation, monterey:       "f4cc50ea189207693a82a761cc673df6ae4e29dc7c3e9ad8b592d2713dd645db"
    sha256 cellar: :any_skip_relocation, big_sur:        "d43ffcfb31f5e008f17e0f9e989ed86c4efe38a3aabe9f3b70cd3560b6996521"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "ee2b92700a4088fac1fdd6d3970ddb28b27ceb938ae7aad062156d060bab8359"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
