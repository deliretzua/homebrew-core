class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-22",
      revision: "ae2adf08f1be00b820be9ef73f312149aaad8467"
  version "2021-10-22"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "7765d150b559e2823fac20aaeb2b6e730c8aa6f4971c43eb461537e1741407ee"
    sha256 cellar: :any_skip_relocation, big_sur:       "4e592698ee426cb63526cf4faed9aba169eef993a9f796a98944f55a7e02d855"
    sha256 cellar: :any_skip_relocation, catalina:      "a6f1d9a7df66d0073f62f3caed5428485cc40a245cdf74ad3c0bb72ddcee512b"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "016c4a5939ab7771d9887495fc79d573d32243ee8593d2e3eef9ee3481ae3a41"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
