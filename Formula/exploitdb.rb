class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-12-21",
      revision: "00cc9f489e3025d35b6f8229ebb654a3e18657ba"
  version "2021-12-21"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "955cd3b4cbe9f9e0bb45ed2c373c5f31ef15e6e295e9ae4a352d6dfc4e129494"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f183f6797970cbb10179c23bcedba9bc41bc4d4c108a2d9528a07aec554349c2"
    sha256 cellar: :any_skip_relocation, monterey:       "3f53ccb73d3c4973170a6296d846a248bdd7bb9b794a8f754c2b351f8f0220d9"
    sha256 cellar: :any_skip_relocation, big_sur:        "5ceebcd3d9aed11e3f734f8ecf5239eca0210c92f6d437a6aefb48368127f13f"
    sha256 cellar: :any_skip_relocation, catalina:       "fa7833b1a0954f8c2001d261372619eec8aabc75a44f25a960e33f87eb118f0b"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "1b1f27e901c159b42206f76bbf2725281133499f77c20454f501f4f38279911b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
