class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-03-10",
      revision: "280b8f430acea43cad61a931c3c664f7ae9dc7c4"
  version "2022-03-10"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "897208b486a59f1d8c11ab764dbee2101d822cf54b8c0450e2f7335217c27c78"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f60a683312be9988e1c4a3df0d120e2889f30b53015050c6db3ff43503725446"
    sha256 cellar: :any_skip_relocation, monterey:       "974d26060439925f00422177bc19c6c27cef63043e3bca6102a6624c2c71fbee"
    sha256 cellar: :any_skip_relocation, big_sur:        "e2a049d030a8934d36f178650723274e3dd2672a6cf92695b355a978ac4d7bf4"
    sha256 cellar: :any_skip_relocation, catalina:       "c5db747d20072d157051c279611a7af4d1e34747aa10ee8add99fa7fc3a0c0fd"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "d9c901d9192801916e2659988b9515020c5a8035bbb5d906e9702d3940771c1a"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
