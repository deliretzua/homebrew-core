class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-15",
      revision: "3e8f9f4d300cf3280b5a0854b70022611592b64b"
  version "2021-10-15"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "a6ba4680f6bb156466b8948cfc920c725d1954e87bee3d3bfcbbb76b15814ddd"
    sha256 cellar: :any_skip_relocation, big_sur:       "328c67b5a3751c60d3a33ee8bf3bebeaff04a13f332a23b7a7ded73590bcf2d0"
    sha256 cellar: :any_skip_relocation, catalina:      "51938d77378c1af83c896bf34e481f7a6a4a4ab789640b748c20ebb725ed795a"
    sha256 cellar: :any_skip_relocation, mojave:        "a8c95dd37df8ad1012d7d221ad9f7c995deda3918d996120c5fa50cd0b4f07e7"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "87901515b7b83d359622e0657b7ec162d767e16d5dc43bbb2aaaa7e7a6bb8eac"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
