class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-03-03",
      revision: "00bdb64074eba58d5c06b6f54bca09837d3fb024"
  version "2022-03-03"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "d7fc7ef2867b6ca540e442a32d3dec7272de1e9144671804a507756605aaed69"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "6dd805ae8e3764768effdeead2b4e4da9ca9a316389ea2e9a3f9fc4cd20c6bd6"
    sha256 cellar: :any_skip_relocation, monterey:       "aa2b7eab0a2c514227830e02653dcf8b0875ebf8c4dc3a646fd03a7c5f86ed2b"
    sha256 cellar: :any_skip_relocation, big_sur:        "3a1fbbc7e1350fee1c1c8313994b7cabf1a1c9513c2e26ebb153d10c7afa568a"
    sha256 cellar: :any_skip_relocation, catalina:       "6fd59d2634f4221d7026880d05d71069dc32aa022efd490ed9932cb8e479a8d0"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "dd317256a06975fd5883267dddfdd8f4c9b4add1dde49f5230c7fcc8571d3203"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
