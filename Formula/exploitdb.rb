class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-12-10",
      revision: "c906261f2cac413eaa5cb3ff7f61d809fc15ced7"
  version "2021-12-10"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "0a360994ab01b381f7d0f5b6a93d23b48be1d763152e8c90a0c3c81f7847d846"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "2f4571e3415c4547fbcbc2fa5f9305138651620e4b2bf6d49c1e07b9e8128e4b"
    sha256 cellar: :any_skip_relocation, monterey:       "f8fbc2a9f380d3c8556fcbf8df88422425427f3cf21d40071ca9df66c5072f6c"
    sha256 cellar: :any_skip_relocation, big_sur:        "926b68e0a8c490f821f67bc7ef4fa3d34f8e515d235ef74d9801b5db23f53efe"
    sha256 cellar: :any_skip_relocation, catalina:       "fcb14ae269627648ad67b52c06233aa67e4fdb7167bfe5819aa0463b2bf58116"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "f97a651be4288edf63a0818236cf4f1111ed5f425d5c84b081616ae0ffc4bd42"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
