class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-02-09",
      revision: "4925dbd7d7cc7863dd1d2fbc6934045c0ce810b2"
  version "2023-02-09"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "7686bf55cfbc60c217072ce53d0fe74fcfc4a561d16488f4c466a424b06b60dd"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "0007877e1b76792a4904a877daf9ceb54ab5153274632b1bdef829ba42703448"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "22dc13099471213c82a9cf6a92cb4756fbbf64c1a4bf14fd779d9ce70ea8750e"
    sha256 cellar: :any_skip_relocation, ventura:        "cc29201bba37010707b18529c2bd6c2ceb415d3912077dd05b86e6d716ea0b04"
    sha256 cellar: :any_skip_relocation, monterey:       "391885939364b9835a19c45d78f9691c2f33178d0f11f0c7364c172aa845b217"
    sha256 cellar: :any_skip_relocation, big_sur:        "c05efbdda4190746d988eb3aa1cb2a6f356d7516c140758057bcaae47d748bca"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "b8f31f4d5bb338425a01d2e7031a313edff269b0657e995c1a09de6e7b69e9ab"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
