class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-04-27",
      revision: "004fdfd467d849f2422c7aebbada8776005a8158"
  version "2022-04-27"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "6662d6742406c7ceb746c2bda64763c33f28a03ba70d97a1f46e43419348f237"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "a0f54a67393b2a7197594fb3b4e259fcff1fc321b809ac60fa7e0b34a627bdd4"
    sha256 cellar: :any_skip_relocation, monterey:       "ff20945347c6bee5817406a57648aac3b76d5c1185aa10b6f2cdc4a3b581ff6c"
    sha256 cellar: :any_skip_relocation, big_sur:        "bb62da30135f0b27af549ee7ca9622b9512beeadbad0e1c561e65b42676e4ace"
    sha256 cellar: :any_skip_relocation, catalina:       "78f24e3c1da65150f0d1bc0be82ff8db92e4e1602c1517e1ec981b00656359c3"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "07aaf5fed6d7e644f4c31f9d83021c6f260447601d0934315174814e47ac9968"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
