class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://gitlab.com/exploit-database/exploitdb.git",
      tag:      "2023-02-10",
      revision: "4c211fe12728e523d36ed2d08d28245bfb1b576f"
  version "2023-02-10"
  license "GPL-2.0-or-later"
  head "https://gitlab.com/exploit-database/exploitdb.git", branch: "main"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_ventura:  "1d9c9675a1fb249cce109c48fdf097e95bc60528d282d9d1e263d635249c8df1"
    sha256 cellar: :any_skip_relocation, arm64_monterey: "67660e2902400b9857ace45f5092d62332ba9a6e017950fe1435c0c2ba6dc7b5"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "f4b7940595c077c403e764ad20d1832085d559b3462edaa8694a906c7277b9cd"
    sha256 cellar: :any_skip_relocation, ventura:        "15e6c39e05fc29dcec72c4ae68c62ba4911d9e1dcf3791adbf2755c58623fdcf"
    sha256 cellar: :any_skip_relocation, monterey:       "c53f28a0a04b59911b62803c5fc2a2aed54b3c3adfa7576aef2e846645a9fff2"
    sha256 cellar: :any_skip_relocation, big_sur:        "2dfee0f9d5d6b89bac9ff2271ae02124aa48030421da81ae37aea2cc12fb1cda"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "a312e26f1a9036a48a99b9a8a2db7ff86330198193918116d54f2ce454b303c0"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
