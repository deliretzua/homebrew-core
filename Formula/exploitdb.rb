class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-13",
      revision: "1cf7d7364aa72bcaefa5fe712fa9c121287d11fb"
  version "2021-10-13"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "ab60336e0586e033c3e2ce4f3d571685d133a1c183b41b27d259cbe18551336f"
    sha256 cellar: :any_skip_relocation, big_sur:       "30adc2f459fab923fd3c9f8af6718bbbc29050a3557bbb47042db744888fe0a0"
    sha256 cellar: :any_skip_relocation, catalina:      "7fb732c42eebba28d1cb6087fd5849b46ec24ca98f77ea73560243ad51cef68b"
    sha256 cellar: :any_skip_relocation, mojave:        "5516f3f94a91bf0f0b47121e7512291aad71ccd63090c9f8922b8aa744b78122"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "8650f7b4a3e6498b4964f599ca9dbaa992986a98ca48843a6f13dee54ac0e41e"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
