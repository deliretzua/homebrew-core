class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-29",
      revision: "f33a724e0b9704465cd349542b4744a6528957a8"
  version "2021-10-29"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "3875c9b8ca5cc049aefb4a885c995b941156f34f838e1b7d9c83c9f68d25416d"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "c8f26eaab50f1da511f50521283f38f401999142f5e915d2265fdc87c861fa0b"
    sha256 cellar: :any_skip_relocation, monterey:       "a1beb9e8e5c83cdc96cc4d91e7858242cba73160a86778c78f5289bec1e633b2"
    sha256 cellar: :any_skip_relocation, big_sur:        "2bc7e893148b9dc2ac88459da63a6ca4f4d7aafe570ed3c0ebd1feb3f0da48bc"
    sha256 cellar: :any_skip_relocation, catalina:       "0378d572e771ea78393e9b2ac2c6a13a7d3a89e08286d630cdf717b4eee44d57"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "475631f442bbc92f21f8b0dd8936b33d29905126d0158c94e6be27255f8ca4ed"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
