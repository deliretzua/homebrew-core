class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2021-10-12",
      revision: "a250e824583d621685d3d3c41bbf5c7e6aa3d411"
  version "2021-10-12"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_big_sur: "7cca11b71779e60c17ed61c8f46901c1ccdd73530ed6af9b503b3a6d01e6f31e"
    sha256 cellar: :any_skip_relocation, big_sur:       "f996ffa9991798b9f0d6d0b594715ef73f6b0843157e3f32b5a70603f94edb1f"
    sha256 cellar: :any_skip_relocation, catalina:      "88f0c035976ac15e95a2526b59f79aa29226d08768c75b6e4246433c1c70799e"
    sha256 cellar: :any_skip_relocation, mojave:        "659797191f6e60efe6f6abcb76c48a30808fe8c8cd147750868f3d4fe4eb65e0"
    sha256 cellar: :any_skip_relocation, x86_64_linux:  "3f746f6f36a307208231edf36a926eee3babc848eec5f0c0a62d24775f25b96b"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
