class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-03-24",
      revision: "498e749e36c3b2d097fe6dbd104b772a680f21ed"
  version "2022-03-24"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "c685e806a062acaf098a708ab724ac4fc3d82e481d8da7f1bfb10616a3ab6ae4"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "fc5e82f53368ebaa2b7512c534ff713ddc57acf22dd7acb63e6280461cae8f67"
    sha256 cellar: :any_skip_relocation, monterey:       "72edc224f8f7f279c3c013ff560ce693a375d8d58266055fef3785c4df4d4e73"
    sha256 cellar: :any_skip_relocation, big_sur:        "239d6ae6d512b67ef0fb1a8e5b1e64e4b005f1ab0b8c265c2266f4a42abb6058"
    sha256 cellar: :any_skip_relocation, catalina:       "7fc55e38c824ed5e3f084cd689b9ece0cca0c70f322acaab56a1463299a5a474"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "6c509900781ac182a443ddb327440132355c70c2b1a394fa1c5a764a3f49891d"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
