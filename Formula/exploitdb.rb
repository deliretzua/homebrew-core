class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-06-04",
      revision: "3daddca95594dffebaa3363dc8c3f01d68a045a2"
  version "2022-06-04"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "7a4332371c39f22dfaf4a472a8fd50122e73d8a280532ece7c4a0965b0847932"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "00a2f224926317af919d2bdac6d28205220470c16928d481a439a5c2aec5742d"
    sha256 cellar: :any_skip_relocation, monterey:       "3c831d06ad8e59108a337012b18c440c850314c58ded3a4dd33d6488a6fc0f4d"
    sha256 cellar: :any_skip_relocation, big_sur:        "73c66a90898cc36e414e184e9665452ea0210fabdb14c40d78a33761c6fea624"
    sha256 cellar: :any_skip_relocation, catalina:       "5bde7ac7b16e8688a34e077479299c2b3f58009277db3046a9d4bbedeac47f5a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "edd5593d204aa54732b15d37df84b51c36380d80ddec782f9c9568a9a28295c9"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
