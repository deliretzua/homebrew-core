class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-03-01",
      revision: "bba496461e055be6dffc797a4115f4b39cdda720"
  version "2022-03-01"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "a035a6b50533a61d82b84bda84407435e96199ab347a7828249a2c9e743002d4"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "39831984721bcce48a1b27e57794c7087d128a56671290b549ffa7443402761e"
    sha256 cellar: :any_skip_relocation, monterey:       "a3ecd3cc6f4b61ebf5778ed281af09e4468ade902b9f3a3d814a97c79043d6d1"
    sha256 cellar: :any_skip_relocation, big_sur:        "1de8a84d30366ae132dd330bfea0734101b2e2f3edc4113a7855c6bf2224fe15"
    sha256 cellar: :any_skip_relocation, catalina:       "f863c82c8094afed0f307ceb6e800e2d2085e7fa05f445beb297e3d4f449077a"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "288c0e255685efa5ed547611703d2751613563f5b5267e76d4539e482380a206"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
