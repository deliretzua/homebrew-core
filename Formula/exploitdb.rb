class Exploitdb < Formula
  desc "Database of public exploits and corresponding vulnerable software"
  homepage "https://www.exploit-db.com/"
  url "https://github.com/offensive-security/exploitdb.git",
      tag:      "2022-06-11",
      revision: "5012842b97f4317dde2bc3ae2ebdbf6099607071"
  version "2022-06-11"
  license "GPL-2.0-or-later"
  head "https://github.com/offensive-security/exploitdb.git", branch: "master"

  bottle do
    sha256 cellar: :any_skip_relocation, arm64_monterey: "df34c516905656484fd7429cb9964c50bef29cefe32c3fd6504cd1f8361c5595"
    sha256 cellar: :any_skip_relocation, arm64_big_sur:  "9d81a12cc3e691d34d1fe6322ab51969407886ca91c22da2e16f80bdc1efd5af"
    sha256 cellar: :any_skip_relocation, monterey:       "cdc62a500a44432c7a4bcc57a6ea4ac8f574bc366deff0ada3a6d70ad7b84b6a"
    sha256 cellar: :any_skip_relocation, big_sur:        "d3213f3c3fa34ea150c6b4fd3c128e0e37edfe435a330d772df736f722581a29"
    sha256 cellar: :any_skip_relocation, catalina:       "7d6384c0f8a8c74a737943ab2966e2e698e1b1716d81d0bc9712f72e8faf4b26"
    sha256 cellar: :any_skip_relocation, x86_64_linux:   "c7e09537010627eafdd3e5e31081ee5bb593f46a0f0d53286e3be1e0b09f6543"
  end

  def install
    inreplace "searchsploit",
              "rc_file=\"\"", "rc_file=\"#{etc}/searchsploit_rc\""

    optpath = opt_share/"exploitdb"
    inreplace ".searchsploit_rc" do |s|
      s.gsub! "\"/opt/exploitdb\"", optpath
      s.gsub! "\"/opt/exploitdb-papers\"", "#{optpath}-papers"
    end

    bin.install "searchsploit"
    etc.install ".searchsploit_rc" => "searchsploit_rc"

    pkgshare.install %w[.git exploits files_exploits.csv files_shellcodes.csv
                        shellcodes]
  end

  test do
    system "#{bin}/searchsploit", "sendpage"
  end
end
